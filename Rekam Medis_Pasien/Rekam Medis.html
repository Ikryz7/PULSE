<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="images/logo_fix.png">
    <title>Rekam Medis | PULSE by Klinik XYZ</title>
</head>

<body>

    <div class="container">
        <!-- Sidebar Section -->
        <aside>
            <div class="toggle">
                <div class="logo">
                    <img src="images/logo_fix.png">
                    <h2>
                        <span class="danger">PULSE</span>
                        <span class="by-telkomedika">by Klinik XYZ</span>
                    </h2>
                </div>
                <div class="close" id="close-btn">
                    <span class="material-icons-sharp">
                        close
                    </span>
                </div>
            </div>

            <div class="sidebar">
                <a href="../Dashboard_Pasien/index.html">
                    <span class="fas fa-home"></span>
                    <h3>Dashboard</h3>
                </a>
                <a href="../Pendaftaran_Pasien/Tata Cara Pendaftaran.html">
                    <span class="far fa-address-card"></span>
                    <h3>Pendaftaran</h3>
                </a>
                <a href="../Rekam Medis_Pasien/Rekam Medis.html">
                    <span class="fas fa-file-medical-alt"></span>
                    <h3>Rekam Medis</h3>
                </a>
                <a href="../Login_Pasien/index.html">
                    <span class="fas fa-sign-out-alt"></span> <!-- Ikon Logout -->
                    <h3>Keluar</h3>
                </a>
            </div>
        </aside>
        <!-- End of Sidebar Section -->

        <!-- Main Content -->
<main>
    <h1>Rekam Medis</h1>
    
    <!-- Daftar Riwayat Berobat Pasien -->
    <div class="patients-container">
        <div class="duration-container">
            <h2>Riwayat Berobat Pasien</h2>
            <p>Pasien dapat melihat riwayat berobat yang pernah didaftarkan sebelumnya. Gunakan opsi di bawah untuk menyortir riwayat pasien.</p>
        </div>

        <div class="filter">
            <label class="filter-by">Filter By</label> <!-- Larger "Filter By" label -->
            
            <div class="filter-categories">
                <label for="schedule-filter">Jadwal Periksa:</label>
                <input type="date" id="schedule-filter">
            
                <label for="poliklinik-filter">Poli Periksa:</label>
                <select id="poliklinik-filter">
                    <option value="">All</option>
                    <option value="Poli Umum">Poli Umum</option>
                    <option value="Poli Gigi">Poli Gigi</option>
                </select>
            
                <label for="doctor-filter">Dokter:</label>
                <select id="doctor-filter">
                    <option value="">All</option>
                    <option value="dr. Surya Putra">dr. Surya Putra</option>
                    <option value="dr. Hana Putri">dr. Hana Putri</option>
                    <option value="drg. Rini Yulianti">drg. Rini Yulianti</option>
                    <option value="drg. Phonna Chlissma">drg. Phonna Chlissma</option>
                </select>
            </div>

</div>            

        <table class="patients-table">
            <thead>
                <tr>
                    <th>Tanggal</th>
                    <th>Waktu Pemeriksaan</th>
                    <th>Poli Periksa</th>
                    <th>Dokter</th>
                    <th>Proses</th>
                    <th>Feedback</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="patients-table-body">
                
            </tbody>
        </table>
        <div class="pagination"></div>

    </div>
</main>
<!-- End of Main Content -->

        <!-- Right Section -->
        <div class="right-section">
            <div class="nav">
                <button id="menu-btn">
                    <span class="material-icons-sharp">
                        menu
                    </span>
                </button>
                <div class="dark-mode">
                    <span class="material-icons-sharp active">
                        light_mode
                    </span>
                    <span class="material-icons-sharp">
                        dark_mode
                    </span>
                </div>

                <div class="profile">
                    <div class="info">
                        <p><b>Wilujeng Sumping!</b></p>
                        <small class="text-muted">Masuk Sebagai Pasien</small>
                    </div>
                    <div class="profile-photo">
                        <img src="images/profile-1.jpg">
                    </div>
                </div>

            </div>
            <!-- End of Nav -->
            <div class="user-profile">
                <div class="logo">
                    <img src="images/logo.png">
                    <h2>Klinik XYZ</h2>
                    <p>Universitas XYZ</p>
                </div>
            </div>
        
            <div class="reminders">
                <div class="header">
                    <h2>Pengingat</h2>
                    <span class="material-icons-sharp">
                        notifications_none
                    </span>
                </div>
        
                <div class="notification">
                    <div class="icon">
                        <span class="material-icons-sharp">
                            alarm
                        </span>
                    </div>
                    <div class="content">
                        <div class="info">
                            <h3>Workshop</h3>
                                    <small class="text_muted">
                                Jumat, 31 Mei 2024
                            </small>
                        </div>
                        </span>
                    </div>
                </div>
        
                <div class="notification deactive">
                    <div class="icon">
                        <span class="material-icons-sharp">
                            alarm
                        </span>
                    </div>
                    <div class="content">
                        <div class="info">
                            <h3>Penyuluhan</h3>
                            <small class="text_muted">
                                Rabu, 22 Mei 2024
                            </small>
                        </div>
        
                        </span>
                    </div>
                </div>
        
                <div class="notification add-reminder">
                    <div>
                        <span class="material-icons-sharp">
                            add
                        </span>
                        <h3>Tambah Pengingat</h3>
                        </span>
                    </div>
                </div>
        
            </div>
        
        </div>
        
        
        </div>
            
    <script src="index.js"></script>
    <script>
        let patientData = [];

// Mengambil data dari patients.json
fetch('../data/patients.json')
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        patientData = data; // Simpan data ke variabel global
        applyFilters(); // Jalankan filter pertama kali
    })
    .catch(error => {
        console.error('Error fetching patient data:', error);
    });
    const scheduleFilter = document.getElementById('schedule-filter');
const poliklinikFilter = document.getElementById('poliklinik-filter');
const doctorFilter = document.getElementById('doctor-filter');

const applyFilters = () => {
    const selectedDate = scheduleFilter.value; // Nilai dari date picker
    const selectedPoli = poliklinikFilter.value;
    const selectedDoctor = doctorFilter.value;

    // Filter data pasien
    const filteredData = patientData.filter(item => {
        const matchDate = !selectedDate || item.tanggal_berobat === selectedDate;
        const matchPoli = !selectedPoli || item.poli === selectedPoli;
        const matchDoctor = !selectedDoctor || item.dokter === selectedDoctor;
        return matchDate && matchPoli && matchDoctor;
    });

    renderFilteredData(filteredData);
};

const renderFilteredData = (data) => {
    const tableBody = document.getElementById('patients-table-body');
    tableBody.innerHTML = ''; // Bersihkan hasil sebelumnya

    if (data.length === 0) {
        const row = document.createElement('tr');
        const cell = document.createElement('td');
        cell.colSpan = 7;  // Sesuaikan dengan jumlah kolom tabel
        cell.innerText = 'No results found.';
        row.appendChild(cell);
        tableBody.appendChild(row);
        return;
    }

    data.forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${item.tanggal_berobat}</td>
            <td>${item.waktu_berobat}</td>
            <td>${item.poli}</td>
            <td>${item.dokter}</td>
            <td class="${getClassByProcess(item.proses)}">${item.proses}</td>
            <td>
  ${item.feedback === 'Belum Mengisi' 
    ? `<a href="Feedback.html" class="fa fa-pencil btn-feedback"></a>` 
    : item.feedback}
</td>

            <td>
  <a href="Detail RM.html?id=12345">
    <i class="fa fa-eye btn-analyze" aria-hidden="true"></i>
  </a>
</td>

        `;
        tableBody.appendChild(row);
    });
};


// Event listener untuk filter
scheduleFilter.addEventListener('change', applyFilters);
poliklinikFilter.addEventListener('change', applyFilters);
doctorFilter.addEventListener('change', applyFilters);

        const tableBody = document.getElementById('patients-table-body');

        let currentPage = 1;
const rowsPerPage = 5;

async function fetchData() {
  try {
    const response = await fetch('http://localhost:3010/patients');
    const patients = await response.json();
    renderTable(patients);
    setupPagination(patients);
  } catch (error) {
    console.error('Error fetching data:', error);
  }
}


function renderTable(data) {
  const tableBody = document.querySelector('.patients-table tbody');
  tableBody.innerHTML = '';

  const start = (currentPage - 1) * rowsPerPage;
  const end = start + rowsPerPage;
  const paginatedData = data.slice(start, end);

  paginatedData.forEach((patient) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${patient.tanggal_berobat}</td>
      <td>${patient.waktu_berobat}</td>
      <td>${patient.poli}</td>
      <td>${patient.dokter}</td>
      <td class="${getClassByProcess(patient.proses)}">${patient.proses}</td>
      <td>${patient.feedback === 'Belum Mengisi' ? '<button class="fa fa-pencil btn-feedback"></button>' : patient.feedback}</td>
      <td><i class="fa fa-eye btn-analyze" aria-hidden="true"></i></td>

    `;
    tableBody.appendChild(row);
  });
}

function setupPagination(data) {
  const pagination = document.querySelector('.pagination');
  pagination.innerHTML = '';

  const totalPages = Math.ceil(data.length / rowsPerPage);

  for (let i = 1; i <= totalPages; i++) {
    const button = document.createElement('button');
    button.textContent = i;
    button.className = currentPage === i ? 'active' : '';
    button.addEventListener('click', () => {
      currentPage = i;
      renderTable(data);
    });
    pagination.appendChild(button);
  }
}

function getClassByProcess(process) {
  if (process === 'Menunggu Obat') return 'yellow';
  if (process === 'Selesai Berobat') return 'green';
  if (process === 'Belum Mengisi Feedback') return 'red';
  return '';
}

// Initialize fetch
fetchData();

    </script>
    
</body>

</html>