<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="images/logo_fix.png">
    <title>Rekam Medis | PULSE by Klinik XYZ</title>
</head>

<body>

    <div class="container">
        <!-- Sidebar Section -->
        <aside>
            <div class="toggle">
                <div class="logo">
                    <img src="images/logo_fix.png">
                    <h2>
                        <span class="danger">PULSE</span>
                        <span class="by-telkomedika">by Klinik XYZ</span>
                    </h2>
                </div>
                <div class="close" id="close-btn">
                    <span class="material-icons-sharp">
                        close
                    </span>
                </div>
            </div>

            <div class="sidebar">
                <a href="../Dashboard_Dokter Umum/index.html">
                    <span class="fas fa-home"></span>
                    <h3>Dashboard</h3>
                </a>
                <a href="../Jadwal_Dokter Umum/index.html">
                    <span class="	fas fa-user-md"></span>
                    <h3>Jadwal</h3>
                </a>
                <a href="../Rekam Medis_Dokter Umum/Rekam Medis.html">
                    <span class="fas fa-file-medical-alt"></span>
                    <h3>Rekam Medis</h3>
                </a>

                <a href="../Pemeriksaan_Dokter Umum/index.html">
                    <span class="fa fa-stethoscope"></span>
                    <h3>Pemeriksaan</h3>
                </a>
                <a href="../Presensi_Dokter Umum/index.html">
                    <span class="	fas fa-id-card-alt"></span>
                    <h3>Presensi</h3>
                </a>
                <a href="../Login_Dokter/index.html">
                    <span class="fas fa-sign-out-alt"></span> <!-- Ikon Logout -->
                    <h3>Keluar</h3>
                </a>
            </div>
        </aside>
        <!-- End of Sidebar Section -->

        <!-- Main Content -->
<main>
    <h1>Rekam Medis</h1>
    
    <!-- Daftar Riwayat Berobat Pasien -->
    <div class="patients-container">
        <div class="duration-container">
            <h2>Riwayat Berobat Pasien</h2>
            <p>Dokter dapat melihat riwayat berobat yang pernah didaftarkan sebelumnya oleh pasien. Gunakan opsi di bawah untuk menyortir rekam medis.</p>
        </div>

        
        <div class="filter">
            <label class="filter-by">Filter By</label> <!-- Larger "Filter By" label -->
            
            <div class="filter-categories"> <!-- Wrapper for filter categories -->
                <label for="nim-filter">NIM/NIP</label>
                <input type="text" id="nim-filter" value="Cari..."> <!-- Default date value set -->

                <label for="rm-filter">Nomor RM</label>
                <input type="text" id="rm-filter" value="Cari..."> <!-- Default date value set -->

                <label for="date-filter">Tanggal Periksa</label>
                <input type="date" id="date-filter" value="2024-10-12"> <!-- Default date value set -->
        
                <label for="time-filter">Waktu Periksa</label>
                <input type="time" id="time-filter" value="10:30"> <!-- Default time value set -->
            </div>
        </div>
<!-- Tambah Rekam Medis Button -->
<div class="button-container">
    <button class="btn-tambah-rekam-medis">Tambah Rekam Medis</button>
</div>

<table class="patients-table">
    <thead>
        <tr>
            <th>NIM/NIP</th>
            <th>Nomor Rekam Medis</th>
            <th>Pasien</th>
            <th>Tanggal Pemeriksaan</th>
            <th>Waktu Pemeriksaan</th>
            <th>Aksi</th>
        </tr>
    </thead>
    <tbody>
        <!-- Data pasien akan dimasukkan di sini -->
    </tbody>
</table>
    </div>
</main>


        <!-- Right Section -->
        <div class="right-section">
            <div class="nav">
                <button id="menu-btn">
                    <span class="material-icons-sharp">
                        menu
                    </span>
                </button>
                <div class="dark-mode">
                    <span class="material-icons-sharp active">
                        light_mode
                    </span>
                    <span class="material-icons-sharp">
                        dark_mode
                    </span>
                </div>

                <div class="profile">
                    <div class="info">
                        <p><b>Wilujeng Sumping!</b></p>
                        <small class="text-muted">Masuk Sebagai Dokter Umum</small>
                    </div>
                    <div class="profile-photo">
                        <img src="images/profile-1.jpg">
                    </div>
                </div>

            </div>
            <!-- End of Nav -->
            <div class="user-profile">
                <div class="logo">
                    <img src="images/logo.png">
                    <h2>Klinik XYZ</h2>
                    <p>Universitas XYZ</p>
                </div>
            </div>
        
            <div class="reminders">
                <div class="header">
                    <h2>Pengingat</h2>
                    <span class="material-icons-sharp">
                        notifications_none
                    </span>
                </div>
        
                <div class="notification">
                    <div class="icon">
                        <span class="material-icons-sharp">
                            alarm
                        </span>
                    </div>
                    <div class="content">
                        <div class="info">
                            <h3>Workshop</h3>
                                    <small class="text_muted">
                                Jumat, 31 Mei 2024
                            </small>
                        </div>
                        </span>
                    </div>
                </div>
        
                <div class="notification deactive">
                    <div class="icon">
                        <span class="material-icons-sharp">
                            alarm
                        </span>
                    </div>
                    <div class="content">
                        <div class="info">
                            <h3>Penyuluhan</h3>
                            <small class="text_muted">
                                Rabu, 22 Mei 2024
                            </small>
                        </div>
        
                        </span>
                    </div>
                </div>
        
                <div class="notification add-reminder">
                    <div>
                        <span class="material-icons-sharp">
                            add
                        </span>
                        <h3>Tambah Pengingat</h3>
                        </span>
                    </div>
                </div>
        
            </div>
        
        </div>
        
        
        </div>
            
    <script src="index.js"></script>
    <script>
        fetch('http://localhost:3008/api/pasien-umum')  // Ganti port ke 3008
        .then(response => {
            if (!response.ok) {
                throw new Error('Data tidak ditemukan');
            }
            return response.json();
        })
        .then(pasienData => {
            renderData(pasienData); // Call the renderData function
            setupFilters(pasienData); // Setup filter functionality
        })
        .catch(error => {
            console.error('Terjadi kesalahan:', error);
        });
    
        // Function to render data into the table
        function renderData(data) {
            const tableBody = document.querySelector('tbody');
            tableBody.innerHTML = ''; // Clear any previous rows
    
            data.forEach(pasien => {
                const administrasi = pasien.administrasi || {}; // Use empty object if data doesn't exist
                const penanganan = pasien.penanganan || {}; // Same for penanganan
    
                // Create a table row with the necessary data
                const tableRow = `
                    <tr>
                        <td>${administrasi.nim || '-'}</td>
                        <td>${administrasi.nomor_rekam_medis || '-'}</td>
                        <td>${administrasi.nama_pasien || '-'}</td>
                        <td>${penanganan.tanggal_penanganan || '-'}</td>
                        <td>${penanganan.waktu_penanganan || '-'}</td>
                        <td>
                            <a href="Detail RM.html?nomor_rekam_medis=${administrasi.nomor_rekam_medis}" class="btn-analyze">
                                <i class="fas fa-eye"></i>
                            </a>
                        </td>
                    </tr>
                `;
                
                // Add the row to the table
                tableBody.innerHTML += tableRow;
            });
        }
    
        // Setup filter functionality
        function setupFilters(data) {
            const nimFilter = document.getElementById('nim-filter');
            const rmFilter = document.getElementById('rm-filter');
            const dateFilter = document.getElementById('date-filter');
            const timeFilter = document.getElementById('time-filter');
    
            // Filter function that checks against the inputs
            function filterData() {
                const nim = nimFilter.value.trim().toLowerCase();  // Clean input for nim filter
                const rm = rmFilter.value.trim().toLowerCase();    // Clean input for rm filter
                const date = dateFilter.value;  // Date format check
                const time = timeFilter.value;  // Time format check
    
                // Log input values for debugging
                console.log('Filter values:', { nim, rm, date, time });
    
                // Filter data based on the provided filter criteria
                const filteredData = data.filter(pasien => {
                    const administrasi = pasien.administrasi || {};
                    const penanganan = pasien.penanganan || {};
    
                    const nimMatch = administrasi.nim && administrasi.nim.toLowerCase().includes(nim);
                    const rmMatch = administrasi.nomor_rekam_medis && administrasi.nomor_rekam_medis.toLowerCase().includes(rm);
    
                    // Convert date to match the format (YYYY-MM-DD)
                    const penangananDate = penanganan.tanggal_penanganan ? new Date(penanganan.tanggal_penanganan).toISOString().split('T')[0] : '';
                    const dateMatch = date ? penangananDate.includes(date) : true;
    
                    // Convert time to match the format (HH:MM)
                    const penangananTime = penanganan.waktu_penanganan || '';
                    const timeMatch = time ? penangananTime.includes(time) : true;
    
                    // Return true if all conditions are met, otherwise false
                    return (
                        (nim === '' || nimMatch) &&
                        (rm === '' || rmMatch) &&
                        dateMatch &&
                        timeMatch
                    );
                });
    
                // If no data found, alert and render empty
                if (filteredData.length === 0) {
                    console.log('No matching data found.');
                }
    
                renderData(filteredData); // Re-render the filtered data
            }
    
            // Add event listeners to the filters
            nimFilter.addEventListener('input', filterData);
            rmFilter.addEventListener('input', filterData);
            dateFilter.addEventListener('input', filterData);
            timeFilter.addEventListener('input', filterData);
        }
    </script>
    
</body>

</html>