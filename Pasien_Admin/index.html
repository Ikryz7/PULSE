<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="images/logo_fix.png">
    <title>Pasien | PULSE by Klinik XYZ</title>
</head>

<body>

    <div class="container">
        <!-- Sidebar Section -->
        <aside>
            <div class="toggle">
                <div class="logo">
                    <img src="images/logo_fix.png">
                    <h2>
                        <span class="danger">PULSE</span>
                        <span class="by-telkomedika">by Klinik XYZ</span>
                    </h2>
                </div>
                <div class="close" id="close-btn">
                    <span class="material-icons-sharp">
                        close
                    </span>
                </div>
            </div>

            <div class="sidebar">
                <a href="../Dashboard_Admin/index.html">
                    <span class="fas fa-home"></span>
                    <h3>Dashboard</h3>
                </a>
                <a href="../Dokter_Admin/index.html">
                    <span class="fas fa-stethoscope"></span>
                    <h3>Dokter</h3>
                </a>
                <a href="../Pasien_Admin/index.html">
                    <span class="fas fa-user-injured"></span>
                    <h3>Pasien</h3>
                </a>
                <a href="../Feedback_Admin/index.html">
                    <span class="fa fa-paper-plane"></span>
                    <h3>Feedback</h3>
                </a>
                <a href="../Presensi_Admin/index.html">
                    <span class="fas fa-id-card-alt"></span>
                    <h3>Presensi</h3>
                </a>
                <a href="../logout"> <!-- Adjust this route for the logout logic -->
                    <span class="fas fa-sign-out-alt"></span>
                    <h3>Keluar</h3>
                </a>
            </div>
        </aside>
        <!-- End of Sidebar Section -->

        <!-- Main Content -->
        <main>
            <h1>Pasien</h1>
            
            <!-- Daftar Antrian Pasien -->
            <div class="patient-queue">
                <h2>Daftar Antrian Pasien</h2>
                <p>Daftar pasien yang telah mendaftar secara online.</p>
                
                <div class="filter">
                    <label class="filter-by">Filter By</label>
                    <!-- Wrapper for filter categories -->
                    <div class="filter-categories">
                        
                        
                        <!-- Filter by Poli Periksa -->
                        <label for="poliklinik-filter">Poli Periksa</label>
                        <select id="poliklinik-filter">
                            <option value="">All</option>
                            <option value="Umum">Umum</option>
                            <option value="Spesialis Anak">Spesialis Anak</option>
                            <option value="Gigi">Gigi</option>
                        </select>
                        
                        <!-- Filter by Dokter -->
                        <label for="dokter-filter">Dokter</label>
                        <select id="dokter-filter">
                            <option value="">All</option>
                            <option value="dr. Surya Putra">dr. Surya Putra</option>
                            <option value="dr. Hana Putri">dr. Hana Putri</option>
                            <option value="drg. Rini Yulianti">drg. Rini Yulianti</option>
                            <option value="drg. Phonna Chlissma">drg. Phonna Chlissma</option>
                            <option value="drg. Ferdian Sugandi">drg. Ferdian Sugandi</option>
                        </select>
                        
                        <!-- Filter by Hasil Kuesioner -->
                        <label for="hasil-kuesioner-filter">Hasil Kuesioner</label>
                        <select id="hasil-kuesioner-filter">
                            <option value="">All</option>
                            <option value="Baik">Baik</option>
                            <option value="Prioritas">Prioritas</option>
                        </select>

                        <!-- Filter by Status -->
                        <label for="status-filter">Status</label>
                        <select id="status-filter">
                            <option value="">All</option>
                            <option value="Disetujui">Disetujui</option>
                            <option value="Ditolak">Ditolak</option>
                        </select>
                    </div>
                </div>
                
                <!-- Table to Display Data -->
                <table class="schedule-table">
                    <thead>
                        <tr>
                            <th>Nama</th>
                            <th>Tanggal Periksa</th>
                            <th>Waktu Periksa</th>
                            <th>Poli Periksa</th>
                            <th>Dokter</th>
                            <th>Hasil Kuesioner</th>
                            <th>Status</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                    </tbody>
                </table>
                
                <div class="pagination">
                    <button class="page-number" onclick="loadPage(1)">1</button>
                    <button class="page-number" onclick="loadPage(2)">2</button>
                    <button class="page-number" onclick="loadPage(3)">3</button>
                    <!-- Add more page numbers dynamically in the JavaScript -->
                </div>
                
                
                <button type="button" class="btn-add-schedule" onclick="window.location.href='timetable.html'">Time Table Pasien</button>
            </div>
        
            <!-- Manual Input Pasien -->
<div class="manual-input">
    <h2>Input Pasien Emergency</h2>
    <p>Data pasien yang datang secara langsung karena keadaan darurat.</p>
    
    <table class="manual-input-table">
        <thead>
            <tr>
                <th>Nama</th>
                <th>NIP/NIK</th>
                <th>Sudah Ditangani?</th>
                <th>Aksi</th>
            </tr>
        </thead>
        <tbody id="manual-input-body">
            <!-- Data Pasien dengan bentuk_penanganan = Darurat akan muncul di sini -->
        </tbody>
    </table>

    <button type="button" class="btn-add-schedule" onclick="window.location.href='Tambah Pasien.html'">Tambah Pasien</button>
</div>
        </main>
        
<!-- End of Main Content -->


        <!-- Right Section -->
        <div class="right-section">
            <div class="nav">
                <button id="menu-btn">
                    <span class="material-icons-sharp">
                        menu
                    </span>
                </button>
                <div class="dark-mode">
                    <span class="material-icons-sharp active">
                        light_mode
                    </span>
                    <span class="material-icons-sharp">
                        dark_mode
                    </span>
                </div>

                <div class="profile">
                    <div class="info">
                        <p><b>Wilujeng Sumping!</b></p>
                        <small class="text-muted">Masuk Sebagai Admin</small>
                    </div>
                    <div class="profile-photo">
                        <img src="images/profile-1.jpg">
                    </div>
                </div>

            </div>
            <!-- End of Nav -->
            <div class="user-profile">
                <div class="logo">
                    <img src="images/logo.png">
                    <h2>Klinik XYZ</h2>
                    <p>Universitas XYZ</p>
                </div>
            </div>

            <div class="reminders">
                <div class="header">
                    <h2>Pengingat</h2>
                    <span class="material-icons-sharp">
                        notifications_none
                    </span>
                </div>

                <div class="notification">
                    <div class="icon">
                        <span class="material-icons-sharp">
                            alarm
                        </span>
                    </div>
                    <div class="content">
                        <div class="info">
                            <h3>Workshop</h3>
                                    <small class="text_muted">
                                Jumat, 31 Mei 2024
                            </small>
                        </div>
                        </span>
                    </div>
                </div>

                <div class="notification deactive">
                    <div class="icon">
                        <span class="material-icons-sharp">
                            alarm
                        </span>
                    </div>
                    <div class="content">
                        <div class="info">
                            <h3>Penyuluhan</h3>
                            <small class="text_muted">
                                Rabu, 22 Mei 2024
                            </small>
                        </div>

                        </span>
                    </div>
                </div>

                <div class="notification add-reminder">
                    <div>
                        <span class="material-icons-sharp">
                            add
                        </span>
                        <h3>Tambah Pengingat</h3>
                        </span>
                    </div>
                </div>

            </div>

        </div>


    </div>

    <script src="index.js"></script>
    <script>
        let currentPage = 1;
        const rowsPerPage = 5;
        let data = [];
        let filteredData = []; // Store filtered data
    
        // Load JSON data
        fetch('../data/kuesioner.json')
            .then(response => response.json())
            .then(jsonData => {
                data = jsonData;
                filteredData = jsonData; // Initialize filteredData with all data
                loadPage(currentPage);
            });
    
        // Daftar dokter berdasarkan poli
        const dokterList = {
            'Poli Umum': ['dr. Surya Putra', 'dr. Hana Putri'],
            'Poli Gigi': ['drg. Phonna Chlissma', 'drg. Ferdian Sugandi', 'drg. Rini Yulianti'],
        };
    
        // Fungsi untuk memilih dokter secara acak
        function getRandomDokter(poli) {
            if (dokterList[poli]) {
                const dokterArray = dokterList[poli];
                return dokterArray[Math.floor(Math.random() * dokterArray.length)];
            }
            return '-'; // Jika poli tidak ditemukan
        }
    
        // Function to render data into the table
        function renderData(data) {
            const tableBody = document.getElementById('table-body'); // ID dari tbody tabel
            tableBody.innerHTML = '';
    
            data.forEach((row) => {
                const identitas = row.identitas || {}; // Gunakan objek kosong jika identitas tidak ada
                const kuesioner = row.kuesioner || {}; // Gunakan objek kosong jika kuesioner tidak ada
                const selectedSchedule = row.selectedSchedule || {}; // Gunakan objek kosong jika identitas tidak ada
    
                // Tentukan status berdasarkan konfirmasiJadwal
                const status = row.konfirmasiJadwal === "Terkonfirmasi" ? "Disetujui" :
                               row.konfirmasiJadwal === "Ditolak" ? "Ditolak" : "-";
    
                // Tentukan apakah tombol aksi ditampilkan atau tidak
                const actionButton = status === "Disetujui"
                    ? `<button class="btn-edit" onclick="window.location.href='Edit Data.html'">Input</button>`
                    : (status === "Ditolak" ? "<span>Pasien Ditolak</span>" : '');
    
                const tableRow = `
                    <tr>
                        <td>${identitas.nama || '-'}</td>
                        <td>${identitas.tanggalPeriksa || '-'}</td>
                        <td>${selectedSchedule.jam || '-'}</td>
                        <td>${identitas.poliPeriksa || '-'}</td>
                        <td>${getRandomDokter(identitas.poliPeriksa)}</td>
                        <td>${kuesioner.kuesioner?.score ? kuesioner.kuesioner.score.toFixed(2) : '-'}</td>
                        <td>${status}</td>
                        <td>${actionButton}</td>
                    </tr>
                `;
                tableBody.innerHTML += tableRow;
            });
        }
    // Mengupdate tombol Input untuk menyimpan data pasien yang dipilih
const actionButton = status === "Disetujui"
    ? `<button class="btn-edit" onclick="openEditPage('${identitas.nim}')">Input</button>`
    : (status === "Ditolak" ? "<span>Pasien Ditolak</span>" : '');

    // Function untuk membuka halaman Edit dan menyimpan data pasien yang dipilih
function openEditPage(nim) {
    // Menyimpan NIM pasien dan data lainnya ke sessionStorage
    const pasienData = data.find(patient => patient.identitas.nim === nim);
    if (pasienData) {
        sessionStorage.setItem('selectedPasien', JSON.stringify(pasienData)); // Menyimpan data pasien
    }
    window.location.href = 'Edit Data.html'; // Arahkan ke halaman Edit
}



        // Function to load the data for a given page
        function loadPage(page) {
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = ''; // Clear current rows
            const startIndex = (page - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const currentData = filteredData.slice(startIndex, endIndex);
    
            renderData(currentData); // Render the data for the current page
        }
    
        // Function to handle page change
        function changePage(offset) {
            currentPage += offset;
            loadPage(currentPage);
        }
    
        // Function to filter data based on selected filters
        function filterData() {
            const poliPeriksa = document.getElementById('poliklinik-filter').value;
            const dokter = document.getElementById('dokter-filter').value;
            const hasilKuesioner = document.getElementById('hasil-kuesioner-filter').value;
            const status = document.getElementById('status-filter').value;
    
            filteredData = data.filter(patient => (
                (poliPeriksa ? patient.identitas.poliPeriksa === poliPeriksa : true) &&
                (dokter ? getRandomDokter(patient.identitas.poliPeriksa) === dokter : true) &&
                (hasilKuesioner ? patient.kuesioner?.kuesioner?.score.toFixed(2) === hasilKuesioner : true) &&
                (status ? (patient.konfirmasiJadwal === "Terkonfirmasi" && status === "Disetujui") ||
                          (patient.konfirmasiJadwal === "Ditolak" && status === "Ditolak") : true)
            ));
    
            loadPage(currentPage); // Reload the page with the filtered data
        }
    
        // Add event listeners for the filters
        document.getElementById('poliklinik-filter').addEventListener('change', filterData);
        document.getElementById('dokter-filter').addEventListener('change', filterData);
        document.getElementById('hasil-kuesioner-filter').addEventListener('change', filterData);
        document.getElementById('status-filter').addEventListener('change', filterData);
    
        function fetchAndRenderDaruratData() {
            fetch('../data/rm.json') // Correct the relative path
                .then(response => response.json())
                .then(pasienData => {
                    const filteredData = pasienData.filter(pasien => pasien.penanganan.bentuk_penanganan === "Darurat");
    
                    const tableBody = document.getElementById('manual-input-body');
                    tableBody.innerHTML = ''; // Clear previous rows
    
                    filteredData.forEach(pasien => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${pasien.administrasi.nama_pasien}</td>
                            <td>${pasien.administrasi.nim}</td>
                            <td class="status done">Sudah</td>
                            <td class="action-buttons">
                                <button class="btn-edit" onclick="window.location.href='Edit Data.html'">Edit</button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error fetching JSON data:', error);
                });
        }
    
        // Call the function to fetch and render the data when the page loads
        window.onload = fetchAndRenderDaruratData;
    </script>
    
    
</body>

</html>